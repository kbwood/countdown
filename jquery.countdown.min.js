/* http://keith-wood.name/countdown.html
   Countdown for jQuery v2.0.0.
   Written by Keith Wood (kbwood{at}iinet.com.au) January 2008.
   Available under the MIT (https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt) license.
   Please attribute the author if you use it. */
(function(m){m.JQPlugin.createPlugin({name:"countdown",defaultOptions:{until:null,since:null,timezone:null,serverSync:null,format:"dHMS",layout:"",compact:!1,padZeroes:!1,significant:0,description:"",expiryUrl:"",expiryText:"",alwaysExpire:!1,onExpiry:null,onTick:null,tickInterval:1},regionalOptions:{"":{labels:"Years Months Weeks Days Hours Minutes Seconds".split(" "),labels1:"Year Month Week Day Hour Minute Second".split(" "),compactLabels:["y","m","w","d"],whichLabels:null,digits:"0123456789".split(""),
timeSeparator:":",isRTL:!1}},_getters:["getTimes"],_rtlClass:"countdown-rtl",_sectionClass:"countdown-section",_amountClass:"countdown-amount",_periodClass:"countdown-period",_rowClass:"countdown-row",_holdingClass:"countdown-holding",_showClass:"countdown-show",_descrClass:"countdown-descr",_timerElems:[],_init:function(){function a(g){g=1E12>g?c?performance.now()+performance.timing.navigationStart:d():g||d();1E3<=g-h&&(b._updateElems(),h=g);e(a)}var b=this;this._super();this._serverSyncs=[];var d=
"function"==typeof Date.now?Date.now:function(){return(new Date).getTime()},c=window.performance&&"function"==typeof window.performance.now,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||null,h=0;!e||m.noRequestAnimationFrame?(m.noRequestAnimationFrame=null,setInterval(function(){b._updateElems()},980)):(h=window.animationStartTime||window.webkitAnimationStartTime||window.mozAnimationStartTime||
window.oAnimationStartTime||window.msAnimationStartTime||d(),e(a))},UTCDate:function(a,b,d,c,e,h,g,l){"object"==typeof b&&b.constructor==Date&&(l=b.getMilliseconds(),g=b.getSeconds(),h=b.getMinutes(),e=b.getHours(),c=b.getDate(),d=b.getMonth(),b=b.getFullYear());var k=new Date;k.setUTCFullYear(b);k.setUTCDate(1);k.setUTCMonth(d||0);k.setUTCDate(c||1);k.setUTCHours(e||0);k.setUTCMinutes((h||0)-(30>Math.abs(a)?60*a:a));k.setUTCSeconds(g||0);k.setUTCMilliseconds(l||0);return k},periodsToSeconds:function(a){return 31557600*
a[0]+2629800*a[1]+604800*a[2]+86400*a[3]+3600*a[4]+60*a[5]+a[6]},_instSettings:function(a,b){return{_periods:[0,0,0,0,0,0,0]}},_addElem:function(a){this._hasElem(a)||this._timerElems.push(a)},_hasElem:function(a){return-1<m.inArray(a,this._timerElems)},_removeElem:function(a){this._timerElems=m.map(this._timerElems,function(b){return b==a?null:b})},_updateElems:function(){for(var a=this._timerElems.length-1;0<=a;a--)this._updateCountdown(this._timerElems[a])},_optionsChanged:function(a,b,d){d.layout&&
(d.layout=d.layout.replace(/&lt;/g,"<").replace(/&gt;/g,">"));this._resetExtraLabels(b.options,d);var c=b.options.timezone!=d.timezone;m.extend(b.options,d);this._adjustSettings(a,b,null!=d.until||null!=d.since||c);d=new Date;(b._since&&b._since<d||b._until&&b._until>d)&&this._addElem(a[0]);this._updateCountdown(a,b)},_updateCountdown:function(a,b){a=a.jquery?a:m(a);if(b=b||a.data(this.name)){a.html(this._generateHTML(b)).toggleClass(this._rtlClass,b.options.isRTL);if(m.isFunction(b.options.onTick)){var d=
"lap"!=b._hold?b._periods:this._calculatePeriods(b,b._show,b.options.significant,new Date);1!=b.options.tickInterval&&0!=this.periodsToSeconds(d)%b.options.tickInterval||b.options.onTick.apply(a[0],[d])}if("pause"!=b._hold&&(b._since?b._now.getTime()<b._since.getTime():b._now.getTime()>=b._until.getTime())&&!b._expiring){b._expiring=!0;if(this._hasElem(a[0])||b.options.alwaysExpire)this._removeElem(a[0]),m.isFunction(b.options.onExpiry)&&b.options.onExpiry.apply(a[0],[]),b.options.expiryText&&(d=
b.options.layout,b.options.layout=b.options.expiryText,this._updateCountdown(a[0],b),b.options.layout=d),b.options.expiryUrl&&(window.location=b.options.expiryUrl);b._expiring=!1}else"pause"==b._hold&&this._removeElem(a[0])}},_resetExtraLabels:function(a,b){for(var d in b)d.match(/[Ll]abels[02-9]|compactLabels1/)&&(a[d]=b[d]);for(d in a)d.match(/[Ll]abels[02-9]|compactLabels1/)&&"undefined"==typeof b[d]&&(a[d]=null)},_adjustSettings:function(a,b,d){for(var c=0,c=null,e=0;e<this._serverSyncs.length;e++)if(this._serverSyncs[e][0]==
b.options.serverSync){c=this._serverSyncs[e][1];break}null!=c?(c=b.options.serverSync?c:0,a=new Date):(c=m.isFunction(b.options.serverSync)?b.options.serverSync.apply(a[0],[]):null,a=new Date,c=c?a.getTime()-c.getTime():0,this._serverSyncs.push([b.options.serverSync,c]));e=b.options.timezone;e=null==e?-a.getTimezoneOffset():e;if(d||!d&&null==b._until&&null==b._since)b._since=b.options.since,null!=b._since&&(b._since=this.UTCDate(e,this._determineTime(b._since,null)),b._since&&c&&b._since.setMilliseconds(b._since.getMilliseconds()+
c)),b._until=this.UTCDate(e,this._determineTime(b.options.until,a)),c&&b._until.setMilliseconds(b._until.getMilliseconds()+c);b._show=this._determineShow(b)},_preDestroy:function(a,b){this._removeElem(a[0]);a.empty()},pause:function(a){this._hold(a,"pause")},lap:function(a){this._hold(a,"lap")},resume:function(a){this._hold(a,null)},toggle:function(a){this[(m.data(a,this.name)||{})._hold?"resume":"pause"](a)},toggleLap:function(a){this[(m.data(a,this.name)||{})._hold?"resume":"lap"](a)},_hold:function(a,
b){var d=m.data(a,this.name);if(d){if("pause"==d._hold&&!b){d._periods=d._savePeriods;var c=d._since?"-":"+";d[d._since?"_since":"_until"]=this._determineTime(c+d._periods[0]+"y"+c+d._periods[1]+"o"+c+d._periods[2]+"w"+c+d._periods[3]+"d"+c+d._periods[4]+"h"+c+d._periods[5]+"m"+c+d._periods[6]+"s");this._addElem(a)}d._hold=b;d._savePeriods="pause"==b?d._periods:null;m.data(a,this.name,d);this._updateCountdown(a,d)}},getTimes:function(a){return(a=m.data(a,this.name))?"pause"==a._hold?a._savePeriods:
a._hold?this._calculatePeriods(a,a._show,a.options.significant,new Date):a._periods:null},_determineTime:function(a,b){var d=this,c=function(a){var b=new Date;b.setTime(b.getTime()+1E3*a);return b},e=function(a){a=a.toLowerCase();for(var b=new Date,c=b.getFullYear(),e=b.getMonth(),f=b.getDate(),n=b.getHours(),q=b.getMinutes(),b=b.getSeconds(),m=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g,p=m.exec(a);p;){switch(p[2]||"s"){case "s":b+=parseInt(p[1],10);break;case "m":q+=parseInt(p[1],10);break;case "h":n+=
parseInt(p[1],10);break;case "d":f+=parseInt(p[1],10);break;case "w":f+=7*parseInt(p[1],10);break;case "o":e+=parseInt(p[1],10);f=Math.min(f,d._getDaysInMonth(c,e));break;case "y":c+=parseInt(p[1],10),f=Math.min(f,d._getDaysInMonth(c,e))}p=m.exec(a)}return new Date(c,e,f,n,q,b,0)};(c=null==a?b:"string"==typeof a?e(a):"number"==typeof a?c(a):a)&&c.setMilliseconds(0);return c},_getDaysInMonth:function(a,b){return 32-(new Date(a,b,32)).getDate()},_normalLabels:function(a){return a},_generateHTML:function(a){var b=
this;a._periods=a._hold?a._periods:this._calculatePeriods(a,a._show,a.options.significant,new Date);for(var d=!1,c=0,e=a.options.significant,h=m.extend({},a._show),g=0;6>=g;g++)d|="?"==a._show[g]&&0<a._periods[g],h[g]="?"!=a._show[g]||d?a._show[g]:null,c+=h[g]?1:0,e-=0<a._periods[g]?1:0;for(var l=[!1,!1,!1,!1,!1,!1,!1],g=6;0<=g;g--)a._show[g]&&(a._periods[g]?l[g]=!0:(l[g]=0<e,e--));var k=a.options.compact?a.options.compactLabels:a.options.labels,f=a.options.whichLabels||this._normalLabels,d=function(c){var d=
a.options["compactLabels"+f(a._periods[c])];return h[c]?b._translateDigits(a,a._periods[c])+(d?d[c]:k[c])+" ":""},n=a.options.padZeroes?2:1,e=function(c){var d=a.options["labels"+f(a._periods[c])];return!a.options.significant&&h[c]||a.options.significant&&l[c]?'<span class="'+b._sectionClass+'"><span class="'+b._amountClass+'">'+b._minDigits(a,a._periods[c],n)+'</span><span class="'+b._periodClass+'">'+(d?d[c]:k[c])+"</span></span>":""};return a.options.layout?this._buildLayout(a,h,a.options.layout,
a.options.compact,a.options.significant,l):(a.options.compact?'<span class="'+this._rowClass+" "+this._amountClass+(a._hold?" "+this._holdingClass:"")+'">'+d(0)+d(1)+d(2)+d(3)+(h[4]?this._minDigits(a,a._periods[4],2):"")+(h[5]?(h[4]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[5],2):"")+(h[6]?(h[4]||h[5]?a.options.timeSeparator:"")+this._minDigits(a,a._periods[6],2):""):'<span class="'+this._rowClass+" "+this._showClass+(a.options.significant||c)+(a._hold?" "+this._holdingClass:"")+'">'+
e(0)+e(1)+e(2)+e(3)+e(4)+e(5)+e(6))+"</span>"+(a.options.description?'<span class="'+this._rowClass+" "+this._descrClass+'">'+a.options.description+"</span>":"")},_buildLayout:function(a,b,d,c,e,h){var g=a.options[c?"compactLabels":"labels"],l=a.options.whichLabels||this._normalLabels,k=function(b){return(a.options[(c?"compactLabels":"labels")+l(a._periods[b])]||g)[b]},f=function(b,c){return a.options.digits[Math.floor(b/c)%10]},k={desc:a.options.description,sep:a.options.timeSeparator,yl:k(0),yn:this._minDigits(a,
a._periods[0],1),ynn:this._minDigits(a,a._periods[0],2),ynnn:this._minDigits(a,a._periods[0],3),y1:f(a._periods[0],1),y10:f(a._periods[0],10),y100:f(a._periods[0],100),y1000:f(a._periods[0],1E3),ol:k(1),on:this._minDigits(a,a._periods[1],1),onn:this._minDigits(a,a._periods[1],2),onnn:this._minDigits(a,a._periods[1],3),o1:f(a._periods[1],1),o10:f(a._periods[1],10),o100:f(a._periods[1],100),o1000:f(a._periods[1],1E3),wl:k(2),wn:this._minDigits(a,a._periods[2],1),wnn:this._minDigits(a,a._periods[2],
2),wnnn:this._minDigits(a,a._periods[2],3),w1:f(a._periods[2],1),w10:f(a._periods[2],10),w100:f(a._periods[2],100),w1000:f(a._periods[2],1E3),dl:k(3),dn:this._minDigits(a,a._periods[3],1),dnn:this._minDigits(a,a._periods[3],2),dnnn:this._minDigits(a,a._periods[3],3),d1:f(a._periods[3],1),d10:f(a._periods[3],10),d100:f(a._periods[3],100),d1000:f(a._periods[3],1E3),hl:k(4),hn:this._minDigits(a,a._periods[4],1),hnn:this._minDigits(a,a._periods[4],2),hnnn:this._minDigits(a,a._periods[4],3),h1:f(a._periods[4],
1),h10:f(a._periods[4],10),h100:f(a._periods[4],100),h1000:f(a._periods[4],1E3),ml:k(5),mn:this._minDigits(a,a._periods[5],1),mnn:this._minDigits(a,a._periods[5],2),mnnn:this._minDigits(a,a._periods[5],3),m1:f(a._periods[5],1),m10:f(a._periods[5],10),m100:f(a._periods[5],100),m1000:f(a._periods[5],1E3),sl:k(6),sn:this._minDigits(a,a._periods[6],1),snn:this._minDigits(a,a._periods[6],2),snnn:this._minDigits(a,a._periods[6],3),s1:f(a._periods[6],1),s10:f(a._periods[6],10),s100:f(a._periods[6],100),
s1000:f(a._periods[6],1E3)},n=d;for(d=0;6>=d;d++)f="yowdhms".charAt(d),n=n.replace(RegExp("\\{"+f+"<\\}([\\s\\S]*)\\{"+f+">\\}","g"),!e&&b[d]||e&&h[d]?"$1":"");m.each(k,function(a,b){n=n.replace(RegExp("\\{"+a+"\\}","g"),b)});return n},_minDigits:function(a,b,d){b=""+b;if(b.length>=d)return this._translateDigits(a,b);b="0000000000"+b;return this._translateDigits(a,b.substr(b.length-d))},_translateDigits:function(a,b){return(""+b).replace(/[0-9]/g,function(b){return a.options.digits[b]})},_determineShow:function(a){a=
a.options.format;var b=[];b[0]=a.match("y")?"?":a.match("Y")?"!":null;b[1]=a.match("o")?"?":a.match("O")?"!":null;b[2]=a.match("w")?"?":a.match("W")?"!":null;b[3]=a.match("d")?"?":a.match("D")?"!":null;b[4]=a.match("h")?"?":a.match("H")?"!":null;b[5]=a.match("m")?"?":a.match("M")?"!":null;b[6]=a.match("s")?"?":a.match("S")?"!":null;return b},_calculatePeriods:function(a,b,d,c){a._now=c;a._now.setMilliseconds(0);var e=new Date(a._now.getTime());a._since?c.getTime()<a._since.getTime()?a._now=c=e:c=
a._since:(e.setTime(a._until.getTime()),c.getTime()>a._until.getTime()&&(a._now=c=e));var h=[0,0,0,0,0,0,0];if(b[0]||b[1]){var g=this._getDaysInMonth(c.getFullYear(),c.getMonth()),l=this._getDaysInMonth(e.getFullYear(),e.getMonth()),l=e.getDate()==c.getDate()||e.getDate()>=Math.min(g,l)&&c.getDate()>=Math.min(g,l),k=function(a){return 60*(60*a.getHours()+a.getMinutes())+a.getSeconds()},l=Math.max(0,12*(e.getFullYear()-c.getFullYear())+e.getMonth()-c.getMonth()+(e.getDate()<c.getDate()&&!l||l&&k(e)<
k(c)?-1:0));h[0]=b[0]?Math.floor(l/12):0;h[1]=b[1]?l-12*h[0]:0;c=new Date(c.getTime());g=c.getDate()==g;l=this._getDaysInMonth(c.getFullYear()+h[0],c.getMonth()+h[1]);c.getDate()>l&&c.setDate(l);c.setFullYear(c.getFullYear()+h[0]);c.setMonth(c.getMonth()+h[1]);g&&c.setDate(l)}var f=Math.floor((e.getTime()-c.getTime())/1E3);c=function(a,c){h[a]=b[a]?Math.floor(f/c):0;f-=h[a]*c};c(2,604800);c(3,86400);c(4,3600);c(5,60);c(6,1);if(0<f&&!a._since)for(a=[1,12,4.3482,7,24,60,60],c=6,e=1,g=6;0<=g;g--)b[g]&&
(h[c]>=e&&(h[c]=0,f=1),0<f&&(h[g]++,f=0,c=g,e=1)),e*=a[g];if(d)for(g=0;6>=g;g++)d&&h[g]?d--:d||(h[g]=0);return h}})})(jQuery);
